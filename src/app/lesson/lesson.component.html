
<!-- Dashboard Header -->
<div class="dashboard-header">
  <button nbButton status="primary" (click)="addLesson()">+ Add Lesson</button>
<div class="search-container">
  <label class="search-label">Filter Lessons By :</label>
  <div class="search-input-wrapper">
    <input nbInput placeholder="Search" fullWidth [(ngModel)]="searchTerm" />
    <nb-icon icon="search-outline" pack="eva" class="search-icon"></nb-icon>
  </div>
</div>

    
</div>

<!-- Add/Edit Lesson Popup --> <!-- NEW: Centered popup --> 
<div class="popup-overlay" *ngIf="showForm">
  <div class="popup-form">
    <h2>{{ editingLesson ? 'Edit Lesson' : 'Add Lesson' }}</h2>

    <!-- Lesson Type Dropdown --> <!-- NEW -->
    <form #lessonForm="ngForm" (ngSubmit)="saveLesson()">

  <!-- Lesson Type -->
  <label>Lesson Type*</label>
  <select nbInput fullWidth [(ngModel)]="lessonData.type" name="type" required #typeCtrl="ngModel">
    <option value="">-- Select Type --</option>
    <option value="Video">Video</option>
    <option value="Document">Document</option>
  </select>
  <div class="error" *ngIf="typeCtrl.invalid && typeCtrl.touched">
    Lesson type is required.
  </div>

  <!-- Conditional File Upload -->
  <label *ngIf="lessonData.type === 'Video'">Upload Video*</label>
  <input *ngIf="lessonData.type === 'Video'" type="file" accept="video/*"
         (change)="onFileSelected($event, 'video')" required #videoCtrl="ngModel" ngModel name="video" />
  <div class="error" *ngIf="lessonData.type === 'Video' && !lessonData.video && lessonForm.submitted">
    Please upload a video file.
  </div>

  <label *ngIf="lessonData.type === 'Document'">Upload Document*</label>
  <input *ngIf="lessonData.type === 'Document'" type="file" accept="application/pdf,.doc,.docx"
         (change)="onFileSelected($event, 'document')" required #docCtrl="ngModel" ngModel name="document" />
  <div class="error" *ngIf="lessonData.type === 'Document' && !lessonData.document && lessonForm.submitted">
    Please upload a document file.
  </div>

  <!-- Lesson Image -->
  <label>Lesson Image</label>
  <input type="file" (change)="onFileSelected($event, 'image')" />

  <!-- Title -->
  <label>Title*</label>
  <input nbInput fullWidth placeholder="Enter Title"
         [(ngModel)]="lessonData.title" name="title" required minlength="3" maxlength="50" #titleCtrl="ngModel" />
  <div class="error" *ngIf="titleCtrl.errors?.['required'] && titleCtrl.touched">
    Title is required.
  </div>
  <div class="error" *ngIf="titleCtrl.errors?.['minlength'] && titleCtrl.touched">
    Title must be at least 3 characters.
  </div>
  <div class="error" *ngIf="titleCtrl.errors?.['maxlength'] && titleCtrl.touched">
    Title cannot exceed 50 characters.
  </div>

  <!-- Description -->
  <label>Description*</label>
  <textarea nbInput fullWidth rows="3"
            [(ngModel)]="lessonData.description"
            name="description" required minlength="10" #descCtrl="ngModel"></textarea>
  <div class="error" *ngIf="descCtrl.errors?.['required'] && descCtrl.touched">
    Description is required.
  </div>
  <div class="error" *ngIf="descCtrl.errors?.['minlength'] && descCtrl.touched">
    Description must be at least 10 characters.
  </div>

  <!-- Optional Attachments -->
  <label>Attachments (Optional)</label>
  <input type="file" multiple (change)="onFileSelected($event, 'attachments')" />

  <!-- Summary -->
  <label>Summary</label>
  <input nbInput fullWidth [(ngModel)]="lessonData.summary" name="summary" />

  <!-- Duration -->
  <label>Duration (minutes)*</label>
  <input nbInput type="number" fullWidth
         [(ngModel)]="lessonData.duration"
         name="duration" required min="1" max="300" #durationCtrl="ngModel" />
  <div class="error" *ngIf="durationCtrl.errors?.['required'] && durationCtrl.touched">
    Duration is required.
  </div>
  <div class="error" *ngIf="durationCtrl.errors?.['min'] && durationCtrl.touched">
    Duration must be at least 1 minute.
  </div>
  <div class="error" *ngIf="durationCtrl.errors?.['max'] && durationCtrl.touched">
    Duration cannot exceed 300 minutes.
  </div>

  <!-- Order Index -->
  <label>Order Index*</label>
  <input nbInput type="number" fullWidth
         [(ngModel)]="lessonData.orderIndex"
         name="orderIndex" required min="1" #orderCtrl="ngModel" />
  <div class="error" *ngIf="orderCtrl.errors?.['required'] && orderCtrl.touched">
    Order index is required.
  </div>
  <div class="error" *ngIf="orderCtrl.errors?.['min'] && orderCtrl.touched">
    Order index must be at least 1.
  </div>

  <!-- Action Buttons -->
  <div class="actions">
    <button nbButton status="basic" type="button" (click)="cancel()">Cancel</button>
    <button nbButton status="success" type="submit" [disabled]="lessonForm.invalid">
      Save
    </button>
  </div>
</form>

  </div>
</div>

<!-- Lessons List -->
<div class="lessons-container">
  <nb-card *ngFor="let lesson of filteredLessons" class="lesson-card">
    <div class="badge" [ngClass]="lesson.type.toLowerCase()">{{ lesson.type }}</div>
    <nb-card-header>
      <img *ngIf="lesson.image" [src]="lesson.image" class="lesson-image" />
    </nb-card-header>
    <nb-card-body>
      <h5>{{ lesson.title }}</h5>
      <p>{{ lesson.description }}</p>
      <div class="lesson-meta">
        <nb-icon *ngIf="lesson.type === 'Video'" icon="video-outline" class="tiny-icon"></nb-icon>
        <nb-icon *ngIf="lesson.type === 'Document'" icon="book-outline" class="tiny-icon"></nb-icon>
        <span>Lesson {{ lesson.orderIndex }} â€¢ {{ lesson.duration }} min</span>
      </div>
    </nb-card-body>
    <nb-card-footer class="footer-actions">


      <button nbButton class="icon-only" *ngIf="lesson.type === 'Video'" 
        (click)="playLessonVideo(lesson)">
  <nb-icon icon="play-circle-outline" class="tiny-icon3"></nb-icon>
</button>

<button nbButton
        class="icon-only"
        *ngIf="lesson.type === 'Document'"
        (click)="openLessonDocument(lesson)"
        nbTooltip="Open Document"
        nbTooltipClass="doc-tooltip"
        nbTooltipPlacement="top">
  <nb-icon icon="file-text-outline" class="tiny-icon4"></nb-icon>
</button>


      
            <button nbButton class="icon-only" (click)="editLesson(lesson)">
        <nb-icon icon="edit-2-outline" class="tiny-icon1"></nb-icon>
      </button>
            <button  nbButton class="icon-only" (click)="confirmDelete(lesson)">
        <nb-icon icon="trash-2-outline" class="tiny-icon2"></nb-icon>
      </button>
    </nb-card-footer>
  </nb-card>
</div>

<!-- Delete Confirmation Popup --> <!-- NEW -->
<div class="popup-overlay" *ngIf="showDeleteConfirm">
  <div class="popup-form delete">
    <h2>Confirm Delete</h2>
    <p>Are you sure you want to delete "<b>{{ lessonToDelete?.title }}</b>"?</p>
    <div class="actions">
      <button nbButton status="basic" (click)="cancelDelete()">Cancel</button>
      <button nbButton status="danger" (click)="deleteLesson()">Delete</button>
    </div>
  </div>
</div>
